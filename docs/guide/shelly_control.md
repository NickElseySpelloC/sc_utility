# Getting Started with ShellyControl

The [ShellyControl class](../reference/shelly_control.md) is designed to make it easy to integrate with Shelly smart switches. Specifically this library supports switches and energy meter as allows you to:

- Get the status of a device including temperature, Mac address, etc. 
- See if a device is online or not
- Read the current state of an input switch 
- Read the current state of an output relay
- Read an energy meter including power, energy, voltage, current and power factor (where available)
- Get the temperature from one or more digitial probes (connected to a Shelly Add-on)
- Change the state of an output relay (i.e. turn on or off)
- Optionally, respond to webhooks generated by the Shelly device, so that your app can wake immediately when an event occurs, such as an input being turned on.

This library supports many device types (30 at the last count) including older models no longer sold by the vendors. 

This library also isolates you from having to deal with the idiosyncrasies of the Shelly APIs. The vendor completely changed the API for generation 2 devices and later, and even with the new API itâ€™s rather complex deal with the different model types and the API calls they support. This library includes a _shelly_models.json_ file that defines the capabilities of each model. Use the print_model_library() method to view this information.

## Initialisation

To initialise an instance of the ShellyControl class, you need to pass it:

1. A SCLogger object - use the [SCLogger](../reference/logging.md) class to get one of these.
2. A dict object containing the configuraton of the Shelly devices that you want to manage. 
  - This information is normally stored in a YAML configuration file and can be read from that file using [SCConfigManager.get_shelly_settings()](../reference/configmanager.md). 
3. If webhook support is needed, your application's threading.Event() object. This will be set when any webhook is received. 

## Configuration reference

Here's an example of a section of yaml file configuration for 3 Shelly devices

{% include "guide/shelly_config_ref.md" %}

## Custom Attrbutes 

You can add custom key/values to Devices, Inputs, Outputs and Meters if needed. For example you could add a group name to each output switch:(

```yaml
ShellyDevices:
  ...
  Devices:
    - Name: Downstairs Lights
      Model: Shelly2PMG3
      Hostname: 192.168.1.23
      ID: 100
      Inputs:
        - Name: "Living Room Switch"
          Webhooks: True
        - Name: "Kitchen Switch"
          Webhooks: True
      Outputs:
        - Name: "Living Room Relay"
          Group: Inside
        - Name: "Kitchen Relay"
          Group: Inside
    - Name: Outside Lights
      Model: Shelly2PMG3
      Hostname: 192.168.1.25
      ID: 200
      Inputs:
        - Name: "Patio Switch"
          Group: Outside
        - Name: "Car Port Switch"
          Group: Outside
      Outputs:
        - Name: "Patio Relay"
        - Name: "Car Port Relay"
    - Name: Testing
      ...
```

If you add custom attributes, you will need to include them in yoour Ceribus validation dict passed to SCConfigManager(). This will be merged in with the default validation structure:

```python
    "ShellyDevices": {
        "schema": {
            "Devices": {
                "schema": {
                    "schema": {
                        "Outputs": {
                            "schema": {
                                "schema": {
                                    "Group": {"type": "string", "required": False, "nullable": True},
                                },
                            },
                        },
                    },
                },
            },
        }
    }
```


These custom attrbutes will be printed by the print_device_status() function and available from the get_**() functions.

## Digital Temperature Probes

{% include "guide/shelly_temp_probes.md" %}

## Future Features 

Some of the things this library might support in the future:

- Support for Authentication
- Support for other types of Shelly device

## Sample code

```python

  {%
    include "../../examples/shelly_example.py"
  %}
```