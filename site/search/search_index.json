{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":"<p>This utility library provides some basic utility functions for:</p> <ul> <li>CSVReader: Reading data from and and writing to CSV files</li> <li>DateHelper: Date and datetime helper functions</li> <li>ExcelReader: Reading data from Excel worksheets, ranges and tables</li> <li>JSONEncoder: Helps convert dicts and lists to json and back, preserving datetime and enum data types.</li> <li>SCCommon: Some common functions used by other classes.</li> <li>SCConfigManager: Reading from and validating YAML style config files</li> <li>SCLogging: Logging messages to the console and a log file and sending email in plain text or HTML format</li> <li>ShellyControl: Controlling Shelly smart switches and energy meters</li> <li>WeatherClient: A simple wrapper for the OpenWeathermap and Open Meteo weather providers</li> </ul> <p>To get started, see the Getting Started page.</p> <p>Use the API Reference navigation to view the API methods for each class.</p>"},{"location":"guide/getting_started/","title":"Spello Consulting Utility Library Getting Started","text":""},{"location":"guide/getting_started/#installing-the-library","title":"Installing the library","text":"<p>The library is available from PyPi, so to add it to your Python project use pip:</p> <pre><code>pip install sc_utility\n</code></pre> <p>Or better yet, use UV:</p> <pre><code>uv add sc_utility\n</code></pre>"},{"location":"guide/getting_started/#configuration-file","title":"Configuration File","text":"<p>The library uses a YAML file for configuration. An example config file (config.yaml.example) is available on Github. Copy this to [your_app_name].yaml before using the library. </p> <p>Here's the example file - the library expects to find the Files and Email sections in the file:</p> <pre><code>AmberAPI:\n    APIKey: somerandomkey342\n    BaseUrl: https://api.amber.com.au/v1\n    Timeout: 15\n\nFiles:\n    LogfileName: logfile.log\n    LogfileMaxLines: 500\n    LogProcessID: False\n    LogfileVerbosity: detailed\n    ConsoleVerbosity: detailed\n\nEmail:\n    EnableEmail: True\n    SMTPServer: smtp.gmail.com\n    SMTPPort: 587\n    SMTPUsername: me@gmail.com\n    SMTPPassword: &lt;Your SMTP password&gt;\n    SubjectPrefix: \"[Bob Portfolio]: \"\n</code></pre>"},{"location":"guide/getting_started/#configuration-parameters","title":"Configuration Parameters","text":""},{"location":"guide/getting_started/#section-files","title":"Section: Files","text":"Parameter Description LogfileName The name of the log file, can be a relative or absolute path. LogfileMaxLines Maximum number of lines to keep in the log file. If zero, file will never be truncated. LogfileVerbosity The level of detail captured in the log file. One of: none; error; warning; summary; detailed; debug; all ConsoleVerbosity Controls the amount of information written to the console. One of: error; warning; summary; detailed; debug; all. Errors are written to stderr all other messages are written to stdout"},{"location":"guide/getting_started/#section-email","title":"Section: Email","text":"Parameter Description EnableEmail Set to True if you want to allow the app to send emails. If True, the remaining settings in this section must be configured correctly. SMTPServer The SMTP host name that supports TLS encryption. If using a Google account, set to smtp.gmail.com SMTPPort The port number to use to connect to the SMTP server. If using a Google account, set to 587 SMTPUsername Your username used to login to the SMTP server. If using a Google account, set to your Google email address. SMTPPassword The password used to login to the SMTP server. If using a Google account, create an app password for the app at https://myaccount.google.com/apppasswords SubjectPrefix Optional. If set, the app will add this text to the start of any email subject line for emails it sends."},{"location":"guide/getting_started/#example-code","title":"Example code","text":"<p>Here's an example module that shows how to use the library classes. Use the API Reference navigation to view the API methods for each class. The code example and the companion config and Excel files is available in the examples/ folder in the Github repo.</p> <pre><code>\n  \"\"\"Example code using the sc_utility libraries. Should not be included in the distrbution.\"\"\"\n\n  import datetime as dt\n  import platform\n  import pprint\n  import sys\n\n  from example_config_schemas import ConfigSchema\n\n  from sc_utility import CSVReader, DateHelper, ExcelReader, SCConfigManager, SCLogger\n\n  CONFIG_FILE = \"examples/example_config.yaml\"\n  EXCEL_FILE = \"examples/example_excel.xlsx\"\n  CSV_FILE = \"examples/example_csv.csv\"\n\n\n  def update_csv():\n      header_config = [\n          {\n              \"name\": \"Symbol\",\n              \"type\": \"str\",\n              \"match\": True,\n              \"sort\": 2,\n          },\n          {\n              \"name\": \"Date\",\n              \"type\": \"date\",\n              \"format\": \"%Y-%m-%d\",\n              \"match\": True,\n              \"sort\": 1,\n              \"minimum\": None,\n          },\n          {\n              \"name\": \"Name\",\n              \"type\": \"str\",\n          },\n          {\n              \"name\": \"Currency\",\n              \"type\": \"str\",\n          },\n          {\n              \"name\": \"Price\",\n              \"type\": \"float\",\n              \"format\": \".2f\",\n          },\n      ]\n\n      extra_data = [\n          {\n              \"Symbol\": \"AAPL\",\n              \"Date\": dt.date(2023, 10, 1),\n              \"Name\": \"Apple Inc.\",\n              \"Currency\": \"USD\",\n              \"Price\": 150.00,\n          },\n          ]\n\n      # Create an instance of the CSVReader class\n      try:\n          csv_reader = CSVReader(CSV_FILE, header_config)\n      except (ImportError, TypeError, ValueError) as e:\n          print(e, file=sys.stderr)\n          return\n\n      csv_reader.update_csv_file(extra_data)\n\n\n  def main():\n      \"\"\"Main function to run the example code.\"\"\"\n      print(f\"Hello from sc-utility running on {platform.system()}\")\n\n      # Get our default schema, validation schema, and placeholders\n      schemas = ConfigSchema()\n\n      # Initialize the SC_ConfigManager class\n      try:\n          config = SCConfigManager(\n              config_file=CONFIG_FILE,\n              default_config=schemas.default,\n              validation_schema=schemas.validation,\n              placeholders=schemas.placeholders\n          )\n      except RuntimeError as e:\n          print(f\"Configuration file error: {e}\", file=sys.stderr)\n          return\n\n      # Print a value from the sample config file\n      print(f\"API key = {config.get('AmberAPI', 'APIKey')}\")\n\n      # Initialize the SC_Logger class\n      try:\n          logger = SCLogger(config.get_logger_settings())\n      except RuntimeError as e:\n          print(f\"Logger initialisation error: {e}\", file=sys.stderr)\n          return\n\n      logger.log_message(\"This is a test message at the summary level.\", \"summary\")\n\n      # Setup email\n      email_settings = config.get_email_settings()\n\n      if email_settings is not None:\n          logger.register_email_settings(email_settings)\n\n          text_msg = \"Hello world from sc-utility example code.\"\n          if logger.send_email(\"Hello world\", text_msg):\n              logger.log_message(\"Email sent OK.\", \"detailed\")\n\n      # Use DateHelper to get the current date and time\n      prior_date = DateHelper.today_add_days(-7)\n      print(f\"Prior date (7 days ago): {prior_date}\")\n\n      # Create an instance of ExcelReader\n      print(\"Testing ExcelReader...\")\n      excel_reader = ExcelReader(EXCEL_FILE)\n\n      # Extract a table\n      try:\n          table_data = excel_reader.extract_data(source_name=\"Table1\", source_type=\"table\")\n      except ImportError as e:\n          print(f\"Error extracting table: {e}\")\n          sys.exit(1)\n      else:\n          print(\"Table data extracted successfully:\\n\")\n          pprint.pprint(table_data)\n\n      # Update a CSV file\n      update_csv()\n\n      # See if we have a fatal error from a previous run\n      if logger.get_fatal_error():\n          print(\"Prior fatal error detected.\")\n          logger.clear_fatal_error()\n\n\n  if __name__ == \"__main__\":\n      main()\n\n</code></pre>"},{"location":"guide/shelly_config_ref/","title":"Shelly config ref","text":"<pre><code>ShellyDevices:\n  AllowDebugLogging: True\n  ResponseTimeout: 5\n  RetryCount: 1\n  RetryDelay: 2\n  PingAllowed: True\n  SimulationFileFolder: simulation_files\n  # Enable or disable the webhook listener\n  WebhooksEnabled: True\n  # IP to listen for webhooks on. This should be the IP address of the machine running the app. Defaults to 0.0.0.0\n  WebhookHost: 192.168.86.32\n  # Port to listen for webhooks on. Defaults to 8787.\n  WebhookPort: 8787\n  # The URI path that webhooks will post to.\n  WebhookPath: /shelly/webhook  \n  # The webhooks to install by default\n  DefaultWebhooks:\n    Inputs:\n      - input.toggle_on\n      - input.toggle_off\n      - input.button_push\n    Outputs:\n      - switch.on\n      - switch.off\n  Devices:\n    - Name: Downstairs Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.23\n      ID: 100\n      Inputs:\n        - ID: 101\n          Name: \"Living Room Switch\"\n          Webhooks: True\n        - ID: 102\n          Name: \"Kitchen Switch\"\n          Webhooks: True\n      Outputs:\n        - ID: 111\n          Name: \"Living Room Relay\"\n        - ID: 112\n          Name: \"Kitchen Relay\"\n      TempProbes:\n        - Name: \"Outside Temp\"\n        - Name: \"Inside Temp\"\n    - Name: Outside Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.25\n      ID: 200\n      Inputs:\n        - ID: 201\n          Name: \"Patio Switch\"\n        - ID: 202\n          Name: \"Car Port Switch\"\n      Outputs:\n        - ID: 211\n          Name: \"Patio Relay\"\n        - ID: 212\n          Name: \"Car Port Relay\"\n    - Name: Testing\n      Model: ShellyPlus1PM\n      Simulate: True\n      Outputs:\n        - Name: \"Test Switch\"\n      Meters:\n        - Name: \"Test Meter\"\n\n</code></pre> <p>The entries are used as follows:</p> Parameter Description ResponseTimeout How long to wait (in seconds) before timeing out when making an API call or ping. RetryCount How many retries to make if an API call times out. RetryDelay How long to wait (in seconds) between retry attempts. PingAllowed Set to False if ICMP isn't suppported by the route to your devices. SimulationFileFolder The folder to save JSON simulation files in. WebhooksEnabled Enable or disable the webhook listener WebhookHost IP to listen for webhooks on. This should be the IP address of the machine running the app. Defaults to 0.0.0.0. WebhookPort Port to listen for webhooks on. Defaults to 8787. WebhookPath The URI path that webhooks will post to. DefaultWebhooks The webhooks to install by default. See the example above for format. Look at the SupportedWebhooks key of an initialised Shelly device to see which webhook events your device supports. Use the  get_device() call to get a device object. Devices A list of dicts, each on defining a Shelly device. - see below <p>The Devices key in the configuration block supports the following keys :</p> Parameter Description Name Your name for this device Model The model Shelly ID for this device. See the Shelly Models List for more. Hostname The network IP address or hostname for this device. ID Your numeric ID for this device. Simulate Set this to True if you don't have access to the device but still want to test your code. When True, this device will be in 'simulation' mode. Rather than make API calls to the device, the state will be written to and read from a local json file (with the same name as your Name entry). You can modify some of the values in this file to test your code. ExpectOffline If set to True, we can expect this device to be offline at times. No warnings will be issued when this happens Inputs A list of dicts defining the inputs (if any) for this device. This section is optional but if defined, the number of entries must match the number of inputs supported by this model. For each input, define a Name and/or an ID. Optionally, add a Webhooks: True entry here to install the default webhooks on this input. Outputs A list of dicts defining the outputs (if any) for this device. This section is optional but if defined, the number of entries must match the number of outputs supported by this model. For each output, define a Name and/or an ID. Optionally, add a Webhooks: True entry here to install the default webhooks on this input. Meters A list of dicts defining the meters (if any) for this device. Note that depending on the devices, the actual meters might be part of the output or seperate energy meters (EM1 API calls). Either way, in this class meters are reported seperately from outputs. This section is optional but if defined, the number of entries must match the number of meters supported by this model. For each meter, define a Name and/or an ID.  Optionally, use the MockRate key to set a Watts / second metering rate for this meter when the device is in Simulation mode. TempProbes A list of dicts defining the temperature probes connected to a Shelly Add-on that's plugged into this device. For each one you must define a Name key that matches the name given to the probe in the app (see below).  Optionally, use the RequiresOutput key to specify the name of an output device that constrains this temp probe. If set, the temperature reading will only be updated when this output is on. <p>Notes:</p> <ul> <li>Either a Device Name or a Device ID must be supplied.</li> </ul>"},{"location":"guide/shelly_control/","title":"Getting Started with ShellyControl","text":"<p>The ShellyControl class is designed to make it easy to integrate with Shelly smart switches. Specifically this library supports switches and energy meter as allows you to:</p> <ul> <li>Get the status of a device including temperature, Mac address, etc. </li> <li>See if a device is online or not</li> <li>Read the current state of an input switch </li> <li>Read the current state of an output relay</li> <li>Read an energy meter including power, energy, voltage, current and power factor (where available)</li> <li>Get the temperature from one or more digitial probes (connected to a Shelly Add-on)</li> <li>Change the state of an output relay (i.e. turn on or off)</li> <li>Optionally, respond to webhooks generated by the Shelly device, so that your app can wake immediately when an event occurs, such as an input being turned on.</li> </ul> <p>This library supports many device types (30 at the last count) including older models no longer sold by the vendors. </p> <p>This library also isolates you from having to deal with the idiosyncrasies of the Shelly APIs. The vendor completely changed the API for generation 2 devices and later, and even with the new API it\u2019s rather complex deal with the different model types and the API calls they support. This library includes a shelly_models.json file that defines the capabilities of each model. Use the print_model_library() method to view this information.</p>"},{"location":"guide/shelly_control/#initialisation","title":"Initialisation","text":"<p>To initialise an instance of the ShellyControl class, you need to pass it:</p> <ol> <li>A SCLogger object - use the SCLogger class to get one of these.</li> <li>A dict object containing the configuraton of the Shelly devices that you want to manage. </li> <li>This information is normally stored in a YAML configuration file and can be read from that file using SCConfigManager.get_shelly_settings(). </li> <li>If webhook support is needed, your application's threading.Event() object. This will be set when any webhook is received. </li> </ol>"},{"location":"guide/shelly_control/#configuration-reference","title":"Configuration reference","text":"<p>Here's an example of a section of yaml file configuration for 3 Shelly devices</p> <pre><code>ShellyDevices:\n  AllowDebugLogging: True\n  ResponseTimeout: 5\n  RetryCount: 1\n  RetryDelay: 2\n  PingAllowed: True\n  SimulationFileFolder: simulation_files\n  # Enable or disable the webhook listener\n  WebhooksEnabled: True\n  # IP to listen for webhooks on. This should be the IP address of the machine running the app. Defaults to 0.0.0.0\n  WebhookHost: 192.168.86.32\n  # Port to listen for webhooks on. Defaults to 8787.\n  WebhookPort: 8787\n  # The URI path that webhooks will post to.\n  WebhookPath: /shelly/webhook  \n  # The webhooks to install by default\n  DefaultWebhooks:\n    Inputs:\n      - input.toggle_on\n      - input.toggle_off\n      - input.button_push\n    Outputs:\n      - switch.on\n      - switch.off\n  Devices:\n    - Name: Downstairs Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.23\n      ID: 100\n      Inputs:\n        - ID: 101\n          Name: \"Living Room Switch\"\n          Webhooks: True\n        - ID: 102\n          Name: \"Kitchen Switch\"\n          Webhooks: True\n      Outputs:\n        - ID: 111\n          Name: \"Living Room Relay\"\n        - ID: 112\n          Name: \"Kitchen Relay\"\n      TempProbes:\n        - Name: \"Outside Temp\"\n        - Name: \"Inside Temp\"\n    - Name: Outside Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.25\n      ID: 200\n      Inputs:\n        - ID: 201\n          Name: \"Patio Switch\"\n        - ID: 202\n          Name: \"Car Port Switch\"\n      Outputs:\n        - ID: 211\n          Name: \"Patio Relay\"\n        - ID: 212\n          Name: \"Car Port Relay\"\n    - Name: Testing\n      Model: ShellyPlus1PM\n      Simulate: True\n      Outputs:\n        - Name: \"Test Switch\"\n      Meters:\n        - Name: \"Test Meter\"\n\n</code></pre> <p>The entries are used as follows:</p> Parameter Description ResponseTimeout How long to wait (in seconds) before timeing out when making an API call or ping. RetryCount How many retries to make if an API call times out. RetryDelay How long to wait (in seconds) between retry attempts. PingAllowed Set to False if ICMP isn't suppported by the route to your devices. SimulationFileFolder The folder to save JSON simulation files in. WebhooksEnabled Enable or disable the webhook listener WebhookHost IP to listen for webhooks on. This should be the IP address of the machine running the app. Defaults to 0.0.0.0. WebhookPort Port to listen for webhooks on. Defaults to 8787. WebhookPath The URI path that webhooks will post to. DefaultWebhooks The webhooks to install by default. See the example above for format. Look at the SupportedWebhooks key of an initialised Shelly device to see which webhook events your device supports. Use the  get_device() call to get a device object. Devices A list of dicts, each on defining a Shelly device. - see below <p>The Devices key in the configuration block supports the following keys :</p> Parameter Description Name Your name for this device Model The model Shelly ID for this device. See the Shelly Models List for more. Hostname The network IP address or hostname for this device. ID Your numeric ID for this device. Simulate Set this to True if you don't have access to the device but still want to test your code. When True, this device will be in 'simulation' mode. Rather than make API calls to the device, the state will be written to and read from a local json file (with the same name as your Name entry). You can modify some of the values in this file to test your code. ExpectOffline If set to True, we can expect this device to be offline at times. No warnings will be issued when this happens Inputs A list of dicts defining the inputs (if any) for this device. This section is optional but if defined, the number of entries must match the number of inputs supported by this model. For each input, define a Name and/or an ID. Optionally, add a Webhooks: True entry here to install the default webhooks on this input. Outputs A list of dicts defining the outputs (if any) for this device. This section is optional but if defined, the number of entries must match the number of outputs supported by this model. For each output, define a Name and/or an ID. Optionally, add a Webhooks: True entry here to install the default webhooks on this input. Meters A list of dicts defining the meters (if any) for this device. Note that depending on the devices, the actual meters might be part of the output or seperate energy meters (EM1 API calls). Either way, in this class meters are reported seperately from outputs. This section is optional but if defined, the number of entries must match the number of meters supported by this model. For each meter, define a Name and/or an ID.  Optionally, use the MockRate key to set a Watts / second metering rate for this meter when the device is in Simulation mode. TempProbes A list of dicts defining the temperature probes connected to a Shelly Add-on that's plugged into this device. For each one you must define a Name key that matches the name given to the probe in the app (see below).  Optionally, use the RequiresOutput key to specify the name of an output device that constrains this temp probe. If set, the temperature reading will only be updated when this output is on. <p>Notes:</p> <ul> <li>Either a Device Name or a Device ID must be supplied.</li> </ul>"},{"location":"guide/shelly_control/#custom-attrbutes","title":"Custom Attrbutes","text":"<p>You can add custom key/values to Devices, Inputs, Outputs and Meters if needed. For example you could add a group name to each output switch:(</p> <pre><code>ShellyDevices:\n  ...\n  Devices:\n    - Name: Downstairs Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.23\n      ID: 100\n      Inputs:\n        - Name: \"Living Room Switch\"\n          Webhooks: True\n        - Name: \"Kitchen Switch\"\n          Webhooks: True\n      Outputs:\n        - Name: \"Living Room Relay\"\n          Group: Inside\n        - Name: \"Kitchen Relay\"\n          Group: Inside\n    - Name: Outside Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.25\n      ID: 200\n      Inputs:\n        - Name: \"Patio Switch\"\n          Group: Outside\n        - Name: \"Car Port Switch\"\n          Group: Outside\n      Outputs:\n        - Name: \"Patio Relay\"\n        - Name: \"Car Port Relay\"\n    - Name: Testing\n      ...\n</code></pre> <p>If you add custom attributes, you will need to include them in yoour Ceribus validation dict passed to SCConfigManager(). This will be merged in with the default validation structure:</p> <pre><code>    \"ShellyDevices\": {\n        \"schema\": {\n            \"Devices\": {\n                \"schema\": {\n                    \"schema\": {\n                        \"Outputs\": {\n                            \"schema\": {\n                                \"schema\": {\n                                    \"Group\": {\"type\": \"string\", \"required\": False, \"nullable\": True},\n                                },\n                            },\n                        },\n                    },\n                },\n            },\n        }\n    }\n</code></pre> <p>These custom attrbutes will be printed by the print_device_status() function and available from the get_**() functions.</p>"},{"location":"guide/shelly_control/#digital-temperature-probes","title":"Digital Temperature Probes","text":"<p>If you have a Shelly Add-on installed on your Shelly switch, then you can connect up to 5 ds18b20 probes to the add-on. You must setup the probe(s) as follows before adding the probe's name to the ShellyDevices:Device:TempProbes section of your config file:</p> <p>Once you have connected the Shelly Add-on to your Shelly smart switch and connected your DS18B20 temperature probes to the add on, you need to configure the probes in the mobile app:</p> <ol> <li>Go to the Shelly device you have installed the Add-on to and configure the add-on<ul> <li>Click Add-on peripherals section</li> <li>Change to Sensor Addon and then reboot if prompted</li> </ul> </li> <li>After reboot, go back to same tab and click Add Add-on Peripheral<ul> <li>Select Temperature (DS18B20)</li> <li>Select a probe listed from the automatic scan and click Add Peripheral</li> <li>Reboot when prompted</li> </ul> </li> <li>After reboot, go back to same tab and click the settings gear icon next to the newly added probe<ul> <li>Give the probe a name (important) - for example \"Roof Temp\"</li> <li>Optionally enable the 'extract peripheral as device' option (if you want it to appear as a seperate device on your dashboard</li> </ul> </li> <li>Repeat steps 2 and 3 for any other connected probes</li> </ol> <p>Now add these probe(s) to ShellyDevices:Device:TempProbes section of your config file, being sure to use exactly the same names as you used in the Shelly app.</p> <pre><code>ShellyDevices:\n  ...\n  Devices:\n    - Name: Downstairs Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.23\n      ...\n      TempProbes:\n        - Name: \"Roof Temp\"\n</code></pre>"},{"location":"guide/shelly_control/#future-features","title":"Future Features","text":"<p>Some of the things this library might support in the future:</p> <ul> <li>Support for Authentication</li> <li>Support for other types of Shelly device</li> </ul>"},{"location":"guide/shelly_control/#sample-code","title":"Sample code","text":"<pre><code>\n  \"\"\"Example code using the sc_utility libraries. Should not be included in the distrbution.\"\"\"\n\n  import platform\n  import sys\n  import threading\n\n  from example_config_schemas import ConfigSchema\n\n  from sc_utility import SCConfigManager, SCLogger, ShellyControl\n\n  CONFIG_FILE = \"examples/example_config.yaml\"\n\n\n  def main():  # noqa: PLR0914, PLR0915\n      \"\"\"Main function to run the example code.\"\"\"\n      loop_delay = 5\n      loop_count = 0\n      max_loops = 20\n      wake_event = threading.Event()\n\n      print(f\"Hello from sc-utility running on {platform.system()}\")\n\n      # Get our default schema, validation schema, and placeholders\n      schemas = ConfigSchema()\n\n      # Initialize the SC_ConfigManager class\n      try:\n          config = SCConfigManager(\n              config_file=CONFIG_FILE,\n              default_config=schemas.default,\n              validation_schema=schemas.validation,\n              placeholders=schemas.placeholders\n          )\n      except RuntimeError as e:\n          print(f\"Configuration file error: {e}\", file=sys.stderr)\n          return\n\n      # Initialize the SC_Logger class\n      try:\n          logger = SCLogger(config.get_logger_settings())\n      except RuntimeError as e:\n          print(f\"Logger initialisation error: {e}\", file=sys.stderr)\n          return\n\n      shelly_settings = config.get_shelly_settings()\n\n      if shelly_settings is None:\n          print(\"No Shelly settings found in the configuration file.\")\n          return\n\n      # Initialize the SC_ShellyControl class\n      try:\n          shelly_control = ShellyControl(logger, shelly_settings, wake_event)  # type: ignore[arg-type]\n      except RuntimeError as e:\n          print(f\"Shelly control initialization error: {e}\", file=sys.stderr)\n          return\n\n      # Print the model library\n      print(f\"Print brief version of model library:\\n {shelly_control.print_model_library(mode_str='brief')}\")\n\n      # Print the list of devices as configured in the config file\n      print(f\"Print all devices:\\n {shelly_control.print_device_status()}\")\n\n      # Get a device\n      device_identity = \"Testing\"\n      try:\n          device = shelly_control.get_device(device_identity)\n      except (RuntimeError, TimeoutError) as e:\n          print(e, file=sys.stderr)\n      else:\n          print(f\"Device {device_identity} model: {device.get('Model', 'Unknown')}\")\n          print(f\"Device {device_identity} is {'online' if device.get('Online', False) else 'offline'}.\")\n\n      # Change the output of a device\n      output_identity = \"Test Switch\"\n      output = shelly_control.get_device_component(\"output\", output_identity)\n      current_state = output[\"State\"]\n      result, did_change = shelly_control.change_output(output_identity, not current_state)\n      print(f\"Output {output_identity} changed: {did_change}, Result: {result}\")\n\n      # Loop and listed for webhook events\n      while loop_count &lt; max_loops:  # noqa: PLR1702\n          print(f\"Starting loop {loop_count + 1}/{max_loops}\")\n\n          # Do application stuff here\n\n          # Wait for a webhook event or timeout\n          wake_event.wait(timeout=loop_delay)\n          if wake_event.is_set():\n              try:\n                  # We were woken by a webhook call\n                  event = shelly_control.pull_webhook_event()\n                  if event:\n                      print(f\"Received webhook event: {event.get('Event')}\")\n                      if event.get(\"Event\") in {\"input.toggle_on\", \"input.toggle_off\"}:\n                          # An input was toggled on/off, change the corresponding output\n                          output_identity = event.get(\"Component\")\n                          if not output_identity:\n                              print(f\"Unable to get component object for event: {event}\", file=sys.stderr)\n                              continue\n                          new_state = event.get(\"Event\") == \"input.toggle_on\"\n                          result, did_change = shelly_control.change_output(output_identity, new_state)\n                          print(f\"Output {output_identity} changed: {did_change}, Result: {result}\")\n              except (AttributeError, RuntimeError) as e:\n                  print(f\"Error processing webhook event: {e}\", file=sys.stderr)\n              wake_event.clear()\n          loop_count += 1\n\n\n  if __name__ == \"__main__\":\n      main()\n\n</code></pre>"},{"location":"guide/shelly_control_objects/","title":"ShellyControl Object Reference","text":"<p>This page provides a quick reference to the attributes of the main ShellyControl dictionary object types. </p>"},{"location":"guide/shelly_control_objects/#devices","title":"Devices","text":"<p>ShellyControl.devices is a list of all the Shelly smart switch devices being managed by this class. You can reference this attribute directly or use ShellyControl.get_device() to return a device dict, looking up by ID, name, etc. </p> <p>Each device has the following attrbutes</p> <ul> <li>Index: The index of the device in the devices list. Counts from 0.</li> <li>Model: The model tag, used to look up the device characteristics in the shelly_models.json file~</li> <li>Name: The text name for the device. Will be the ClientName if provided, or an internally generated name otherwise.~</li> <li>ClientName: Client provided name for the device~</li> <li>ID: Client provided numeric ID for the device, or auto numbered (starting at 1) if not provided~</li> <li>ObjectType: Will always be 'device'</li> <li>Simulate: Whether to simulate the device or not, default is False~</li> <li>GetConfig: Set to True if the device configuration needs to be refreshed during the next get_status() call.</li> <li>SimulationFile: The file to use for simulation. None if not in simulation mode.</li> <li>*ExpectOffline: If True, it's expected that this device may be offline regularly. Don't issue warnings or errors if it is.</li> <li>ModelName: The vendor's model name**</li> <li>Label: Combination of the ClientName and ID used in logging messages</li> <li>URL: URL to the vendor's product page**</li> <li>Hostname: The DNS hostname or IP address of the device~</li> <li>Port: The port number to use for communication with the device, default is 80~</li> <li>Generation: Numeric value representing which generation this device is.**</li> <li>Protocol: Which API protocol is used to communicate with the device: REST or RPC**</li> <li>Inputs: Number of switch inputs supported by the device, if any**</li> <li>Outputs: Number of relay outputs supported by the device, if any**</li> <li>Meters: Number of energy meters supported by the device, if any**</li> <li>TempProbes: The number of external temperature probes that have been configured for this device.</li> <li>MetersSeperate: Are the energy meters separate from the relay outputs?**</li> <li>TemperatureMonitoring: Is internal temperature monitoring supported by the device?**</li> <li>Online: Is the device online?^</li> <li>MacAddress: The MAC address of the device, if available.^</li> <li>Temperature: The internal temperature of the device in C, if available.^</li> <li>Uptime: The uptime of the device in seconds, if available.^</li> <li>RestartRequired: Whether the device requires a restart to apply changes, if available.^</li> <li>SupportedWebhooks: If this device supports webhooks, this will list the event types supported.</li> <li>InstalledWebhooks: The list of webhooks currently installed on this device.</li> <li>customkeylist: A list of any custom key / value pairs that have been added to the device via the configuration file.</li> </ul>"},{"location":"guide/shelly_control_objects/#device-components","title":"Device Components","text":"<p>A component is a specific hardware component of a Shelly device. Three component types are supported:</p> <ul> <li>Inputs: An input usually wiring in from a physical light switch. Used to send a hardware signal to the Shelly device (e.g. light switch has been turned on)</li> <li>Outputs: A relay output from the Shelly device. This is how the Shelly controls things like lights, motors, etc.</li> <li>Meters: An energy meter that can measure the voltage, current and power draw on an output or a dedicated external eMeter clamps (depending on the model).</li> <li>TempProbes: A ds18b20 digitial temperature probe connected to a Shelly add-on device.</li> </ul> <p>Different Shelly models have different numbers of inputs, outputs and meters and some may have only a subset of these features. The print_model_library() function will return a list of all supported Shelly devices and the number and type of components that each model supports. The Inputs, Outputs and Meters attributes of the device object (see above) provides a count of the number of components of each type supported by that particular device.</p> <p>All components support the following core attrbutes:</p> <ul> <li>DeviceIndex: The Index of the parent device that this component is a part of.</li> <li>DeviceID: The ID of the parent device that this component is a part of.~</li> <li>ComponentIndex: The index of the component in the list of components of this type on this device. For example the second Input component on the third device in our list will have a ComponentIndex=1. </li> <li>ObjectType: What type of component is this - one of input; output or meter.</li> <li>ID: Client provided numeric ID for the component, or auto numbered (starting at 1) if not provided. This is unique.~</li> <li>Name: Client provided name for the component~</li> <li>Webhooks: True if one or more webhooks have been set for this component.</li> <li>customkeylist: A list of any custom key / value pairs that have been added to the component via the configuration file.</li> </ul>"},{"location":"guide/shelly_control_objects/#input-component","title":"Input component","text":"<p>Input components will also have these attrbutes:</p> <ul> <li>State: Is the input currently on (True) or off (False).</li> </ul>"},{"location":"guide/shelly_control_objects/#output-component","title":"Output component","text":"<p>Output components will also have these attrbutes:</p> <ul> <li>HasMeter: Is there an energy meter associated with this output.</li> <li>State: Is the output currently on (True) or off (False).</li> <li>Temperature: Reported temperature reading for this output relay in C.</li> </ul>"},{"location":"guide/shelly_control_objects/#meter-component","title":"Meter component","text":"<p>Meter components will also have these attrbutes:</p> <ul> <li>OnOutput: Is this meter part of an output relay (True) or a seperate eMeter (False)</li> <li>Power: Current power reading in watts.</li> <li>Voltage: Current voltage reading.</li> <li>Current: Current current reading.</li> <li>PowerFactor: The power factor reading.</li> <li>Energy: Total energy consumed in watt / hours. (When a device is an Simulation mode, you can add a MockRate key to the Meter's configuration section to set a Watts/second metering rate.)</li> </ul>"},{"location":"guide/shelly_control_objects/#temperature-probe-component","title":"Temperature Probe component","text":"<p>Temperature Probe components will also have these attrbutes:</p> <ul> <li>ProbeID: The internal ID assigned by the Shelly device to this add-on. Typically an integer starting at 100.</li> <li>Temperature: Reported temperature reading for this probe in C.</li> <li>LastReadingTime: Last time this probe was read.</li> </ul> <p>Note, depending on the Shelly models, some of these attrbutes may be empty. For example, some earlier generation 1 models would report power but not voltage or current.</p>"},{"location":"guide/shelly_control_objects/#footnotes","title":"Footnotes","text":"<p>**These attributes are retrieved from the shelly_models.json file. ~These attributes are provided by the client in the configuration file. ^This attribute is set when checking the switch status.</p>"},{"location":"guide/shelly_models_list/","title":"List of supported Shelly devices","text":"<p>This is the contents of the shelly_models.json file included with the library,</p> <pre><code>\n  [\n    {\n      \"model\": \"ShellyEM\",\n      \"name\": \"Shelly EM\",\n      \"url\": \"https://www.shelly.com/products/shelly-em-50a-clamp-1\",\n      \"generation\": 1,\n      \"protocol\": \"REST\",\n      \"inputs\": 0,\n      \"outputs\": 1,\n      \"meters\": 2,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": false\n    },\n    {\n      \"model\": \"Shelly2\",\n      \"name\": \"Shelly 2\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen1/#shelly2-overview\",\n      \"generation\": 1,\n      \"protocol\": \"REST\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 1,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly2.5\",\n      \"name\": \"Shelly 2.5\",\n      \"url\": \"https://kb.shelly.cloud/knowledge-base/shelly-2-5\",\n      \"generation\": 1,\n      \"protocol\": \"REST\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly3EM\",\n      \"name\": \"Shelly 3 EM\",\n      \"url\": \"https://kb.shelly.cloud/knowledge-base/shelly-3em\",\n      \"generation\": 1,\n      \"protocol\": \"REST\",\n      \"inputs\": 0,\n      \"outputs\": 0,\n      \"meters\": 3,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": false\n    },\n\n\n\n\n  {\n      \"model\": \"ShellyPlus1PM\",\n      \"name\": \"Shelly Plus 1 PM\",\n      \"url\": \"https://www.shelly.com/products/shelly-plus-1pm\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyPro1\",\n      \"name\": \"Shelly Pro 1\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro1\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyPro1PM\",\n      \"name\": \"Shelly Pro 1PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro1PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 1,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyPlus2PM\",\n      \"name\": \"Shelly Plus 2PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPlus2PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyPro2\",\n      \"name\": \"Shelly Pro 2\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro2\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyPro2PM\",\n      \"name\": \"Shelly Pro 2PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro2PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n\n\n\n\n\n    {\n      \"model\": \"Shelly1G3\",\n      \"name\": \"Shelly 1 Gen3\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen3/Shelly1G3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly1PMG3\",\n      \"name\": \"Shelly 1PM Gen3\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen3/Shelly1PMG3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },  \n    {\n      \"model\": \"ShellyP1\",\n      \"name\": \"Shelly Pro 1\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro1\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyP1PM\",\n      \"name\": \"Shelly Pro 1PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro1PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyP2\",\n      \"name\": \"Shelly Pro 2\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro2\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyP2PM\",\n      \"name\": \"Shelly Pro 2PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro1PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyP3\",\n      \"name\": \"Shelly Pro 3\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro3\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 3,\n      \"outputs\": 3,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"ShellyP4PM\",\n      \"name\": \"Shelly Pro 4PM\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen2/ShellyPro4PM\",\n      \"generation\": 2,\n      \"protocol\": \"RPC\",\n      \"inputs\": 4,\n      \"outputs\": 4,\n      \"meters\": 4,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n\n\n\n\n    {\n      \"model\": \"Shelly1MiniG3\",\n      \"name\": \"Shelly 1 Mini Gen3\",\n      \"url\": \"https://www.shelly.com/products/shelly-1-mini-gen3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly1PMMiniG3\",\n      \"name\": \"Shelly 1PM Mini Gen3\",\n      \"url\": \"https://www.shelly.com/products/shelly-1pm-mini-gen3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly1LG3\",\n      \"name\": \"Shelly 1L Gen3\",\n      \"url\": \"https://www.shelly.com/products/shelly-1l-gen3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly2LG3\",\n      \"name\": \"Shelly 2L Gen3\",\n      \"url\": \"https://www.shelly.com/products/shelly-2l-gen3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly2PMG3\",\n      \"name\": \"Shelly 2PM Gen3\",\n      \"url\": \"https://www.shelly.com/products/shelly-2pm-gen3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n  {\n      \"model\": \"ShellyEMG3\",\n      \"name\": \"Shelly EM Gen3\",\n      \"url\": \"https://shelly-api-docs.shelly.cloud/gen2/Devices/Gen3/ShellyEMG3\",\n      \"generation\": 3,\n      \"protocol\": \"RPC\",\n      \"inputs\": 0,\n      \"outputs\": 1,\n      \"meters\": 2,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": true\n    },  \n\n\n    {\n      \"model\": \"ShellyEMMiniG4\",\n      \"name\": \"Shelly EM Mini Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-em-mini-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 0,\n      \"outputs\": 0,\n      \"meters\": 1,\n      \"meters_seperate\": true,\n      \"temperature_monitoring\": false\n    },\n    {\n      \"model\": \"Shelly1G4\",\n      \"name\": \"Shelly 1 Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-1-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },\n    {\n      \"model\": \"Shelly1PMG4\",\n      \"name\": \"Shelly 1PM Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-1pm-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },  \n    {\n      \"model\": \"Shelly1MiniG4\",\n      \"name\": \"Shelly 1 Mini Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-1-mini-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 0,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },  \n    {\n      \"model\": \"Shelly1PMMiniG4\",\n      \"name\": \"Shelly 1PM Mini Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-1pm-mini-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 1,\n      \"outputs\": 1,\n      \"meters\": 1,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    },  \n    {\n      \"model\": \"Shelly2PMG4\",\n      \"name\": \"Shelly 2PM Gen4\",\n      \"url\": \"https://www.shelly.com/products/shelly-2pm-gen4\",\n      \"generation\": 4,\n      \"protocol\": \"RPC\",\n      \"inputs\": 2,\n      \"outputs\": 2,\n      \"meters\": 2,\n      \"meters_seperate\": false,\n      \"temperature_monitoring\": true\n    }\n   ]\n\n</code></pre>"},{"location":"guide/shelly_temp_probes/","title":"Shelly temp probes","text":"<p>If you have a Shelly Add-on installed on your Shelly switch, then you can connect up to 5 ds18b20 probes to the add-on. You must setup the probe(s) as follows before adding the probe's name to the ShellyDevices:Device:TempProbes section of your config file:</p> <p>Once you have connected the Shelly Add-on to your Shelly smart switch and connected your DS18B20 temperature probes to the add on, you need to configure the probes in the mobile app:</p> <ol> <li>Go to the Shelly device you have installed the Add-on to and configure the add-on<ul> <li>Click Add-on peripherals section</li> <li>Change to Sensor Addon and then reboot if prompted</li> </ul> </li> <li>After reboot, go back to same tab and click Add Add-on Peripheral<ul> <li>Select Temperature (DS18B20)</li> <li>Select a probe listed from the automatic scan and click Add Peripheral</li> <li>Reboot when prompted</li> </ul> </li> <li>After reboot, go back to same tab and click the settings gear icon next to the newly added probe<ul> <li>Give the probe a name (important) - for example \"Roof Temp\"</li> <li>Optionally enable the 'extract peripheral as device' option (if you want it to appear as a seperate device on your dashboard</li> </ul> </li> <li>Repeat steps 2 and 3 for any other connected probes</li> </ol> <p>Now add these probe(s) to ShellyDevices:Device:TempProbes section of your config file, being sure to use exactly the same names as you used in the Shelly app.</p> <pre><code>ShellyDevices:\n  ...\n  Devices:\n    - Name: Downstairs Lights\n      Model: Shelly2PMG3\n      Hostname: 192.168.1.23\n      ...\n      TempProbes:\n        - Name: \"Roof Temp\"\n</code></pre>"},{"location":"reference/common/","title":"Common Functions","text":"<p>Common utility functions and classes used by other classes in the sc_utility package.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.check_hostname_and_type","title":"<code>check_hostname_and_type(target)</code>  <code>staticmethod</code>","text":"<p>Return whether target is a valid IPv4, IPv6, or DNS hostname. Also returns the type.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <code>str</code> <p>The target string to validate.</p> required <p>Returns:</p> Type Description <code>tuple[bool, str | None]</code> <p>A tuple containing a boolean indicating validity and a string indicating the type ('ipv4', 'ipv6', or 'hostname').</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.check_internet_connection","title":"<code>check_internet_connection(urls=None, timeout=3)</code>  <code>staticmethod</code>","text":"<p>Check if the system has an active internet connection by trying to open a connection to common websites.</p> <p>Parameters:</p> Name Type Description Default <code>urls</code> <code>list</code> <p>A list of URLs to check for internet connectivity. Defaults to common DNS servers and websites.</p> <code>None</code> <code>timeout</code> <code>int</code> <p>The timeout in seconds for each request.</p> <code>3</code> <p>Returns:</p> Type Description <code>bool</code> <p>True if the system is connected to the internet, False otherwise.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.get_os","title":"<code>get_os()</code>  <code>staticmethod</code>","text":"<p>Return the name of the operating system.</p> <p>Returns:</p> Type Description <code>str</code> <p>The name of the operating system in lowercase.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.get_process_id","title":"<code>get_process_id()</code>  <code>staticmethod</code>","text":"<p>Return the process ID of the current process.</p> <p>Returns:</p> Type Description <code>int</code> <p>The process ID of the current process.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.get_project_root","title":"<code>get_project_root(marker_files=('pyproject.toml', '.project_root', 'uv.lock', '.git'))</code>  <code>staticmethod</code>","text":"<p>Return the root folder of the Python project.</p> <p>Parameters:</p> Name Type Description Default <code>marker_files</code> <code>tuple</code> <p>A tuple of file names that indicate the project root.</p> <code>('pyproject.toml', '.project_root', 'uv.lock', '.git')</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the project root cannot be found.</p> <p>Returns:</p> Name Type Description <code>root_dir</code> <code>Path</code> <p>The root folder of the Python project as a Path object.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.is_probable_path","title":"<code>is_probable_path(possible_path)</code>  <code>staticmethod</code>","text":"<p>Check if the given string or Path object is likely to be a file path.</p> <p>This method checks if the string is an absolute path, contains a path separator, or has a file extension.</p> <p>Parameters:</p> Name Type Description Default <code>possible_path</code> <code>str | Path</code> <p>The string to check.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if the string is likely a file path, False otherwise.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.is_valid_hostname","title":"<code>is_valid_hostname(target)</code>  <code>staticmethod</code>","text":"<p>Return whether target is a valid IPv4, IPv6, or DNS hostname.</p> <p>Parameters:</p> Name Type Description Default <code>target</code> <code>str</code> <p>The target string to validate.</p> required <p>Returns:</p> Type Description <code>bool</code> <p>A boolean indicating validity.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.ping_host","title":"<code>ping_host(ip_address, timeout=1)</code>  <code>staticmethod</code>","text":"<p>Pings an IP address and returns True if the host is responding, False otherwise.</p> <p>Parameters:</p> Name Type Description Default <code>ip_address</code> <code>str</code> <p>The IP address to ping.</p> required <code>timeout</code> <code>int</code> <p>Timeout in seconds for the ping response. Default is 1 second.</p> <code>1</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the IP address is invalid or the ping system call fails.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the host responds, False otherwise.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.select_file_location","title":"<code>select_file_location(file_name, create_folder=False)</code>  <code>staticmethod</code>","text":"<p>Select the file location for the given file name. It resolves an absolute path for the file_name as follows.</p> <ol> <li>If file_name is an absolute path, return it as a Path object.</li> <li>If file_name is a relative path (contains parent directories), return the absolute path based on the current working directory.</li> <li>If file_name is just a file name, look for it in the current working directory first, then in the root directory.</li> </ol> <p>The root directly is defined as the directory containing the main script being executed (the module containing main).</p> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the project root cannot be determined.</p> <p>Parameters:</p> Name Type Description Default <code>file_name</code> <code>str</code> <p>The name of the file to locate. Can be just a file name, or a relative or absolute path.</p> required <code>create_folder</code> <code>bool</code> <p>If True, create the parent folder if it does not exist. Default is False.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>file_path</code> <code>Path</code> <p>The full path to the file as a Path object. None if the file_name does not appear to be a path.</p>"},{"location":"reference/common/#sc_utility.sc_common.SCCommon.select_folder_location","title":"<code>select_folder_location(folder_path=None, create_folder=False)</code>  <code>staticmethod</code>","text":"<p>Return an absolute folder path for the given (relative) folder path.</p> <p>If folder_path is None, return the project root folder. If folder_path is an absolute path, return it as a Path object. If folder_path is a relative path, return the absolute path based on the project root directory.</p> <p>Parameters:</p> Name Type Description Default <code>folder_path</code> <code>str | None</code> <p>The folder path to locate. Can be None, or a relative or absolute path.</p> <code>None</code> <code>create_folder</code> <code>bool</code> <p>If True, create the folder if it does not exist. Default is False.</p> <code>False</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the project root cannot be determined or if folder creation fails.</p> <p>Returns:</p> Type Description <code>Path | None</code> <p>The full path to the folder as a Path object. None if folder_path is None and project root cannot be determined.</p>"},{"location":"reference/configmanager/","title":"Config Manager","text":"<p>Loads the configuration from a YAML file, validates it, and provides access to the configuration values.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.__init__","title":"<code>__init__(config_file, default_config=None, validation_schema=None, placeholders=None)</code>","text":"<p>Initializes the configuration manager.</p> <p>Parameters:</p> Name Type Description Default <code>config_file</code> <code>str</code> <p>The relative or absolute path to the configuration file.</p> required <code>default_config</code> <code>Optional[dict]</code> <p>A default configuration dict to use if the config file does not exist.</p> <code>None</code> <code>validation_schema</code> <code>Optional[dict]</code> <p>A cerberus style validation schema dict to validate the config file against.</p> <code>None</code> <code>placeholders</code> <code>Optional[dict]</code> <p>A dictionary of placeholders to check in the config. If any of these are found, a exception will be raised.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the config file does not exist and no default config is provided, or if there are YAML errors in the config file.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.check_for_config_changes","title":"<code>check_for_config_changes(last_check)</code>","text":"<p>Check if the configuration file has changed. If it has, reload the configuration.</p> <p>Parameters:</p> Name Type Description Default <code>last_check</code> <code>datetime</code> <p>The last time the config was checked.</p> required <p>Returns:</p> Name Type Description <code>result</code> <code>datetime | None</code> <p>The new last modified time if the config has changed and was reloaded, None otherwise.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.check_for_placeholders","title":"<code>check_for_placeholders(placeholders)</code>","text":"<p>Recursively scan self._config for any instances of a key found in placeholders.</p> <p>If the keys and values match (including nested), return True.</p> <p>Parameters:</p> Name Type Description Default <code>placeholders</code> <code>dict</code> <p>A dictionary of placeholders to check in the config.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If any placeholder is found in the config file, an exception will be raised with a message indicating the placeholder and its value.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if any placeholders are found in the config, otherwise False.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.get","title":"<code>get(*keys, default=None)</code>","text":"<p>Retrieve a value from the config dictionary using a sequence of nested keys.</p> Example <p>value = config_mgr.get(\"DeviceType\", \"WebsiteAccessKey\")</p> <p>Parameters:</p> Name Type Description Default <code>keys</code> <code>*keys</code> <p>Sequence of keys to traverse the config dictionary.</p> <code>()</code> <code>default</code> <code>Optional[variable]</code> <p>Value to return if the key path does not exist.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>value</code> <code>variable</code> <p>The value if found, otherwise the default.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.get_config_file_last_modified","title":"<code>get_config_file_last_modified()</code>","text":"<p>Get the last modified time of the config file.</p> <p>Returns:</p> Type Description <code>datetime | None</code> <p>dt.datetime | None: The last modified time if the config file exists, None otherwise.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.get_email_settings","title":"<code>get_email_settings(config_section='Email')</code>","text":"<p>Returns the email settings from the config file.</p> <p>Parameters:</p> Name Type Description Default <code>config_section</code> <code>Optional[str]</code> <p>The section in the config file where email settings are stored.</p> <code>'Email'</code> <p>Returns:</p> Name Type Description <code>settings</code> <code>dict</code> <p>A dictionary of email settings or None if email is disabled or not configured correctly.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.get_logger_settings","title":"<code>get_logger_settings(config_section='Files')</code>","text":"<p>Returns the logger settings from the config file.</p> <p>Parameters:</p> Name Type Description Default <code>config_section</code> <code>Optional[str]</code> <p>The section in the config file where logger settings are stored.</p> <code>'Files'</code> <p>Returns:</p> Name Type Description <code>settings</code> <code>dict</code> <p>A dictionary of logger settings that can be passed to the SCLogger() class initialization.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.get_shelly_settings","title":"<code>get_shelly_settings(config_section='ShellyDevices')</code>","text":"<p>Returns the the settings for one or more Shelly Smart Switches.</p> <p>Parameters:</p> Name Type Description Default <code>config_section</code> <code>Optional[str]</code> <p>The section in the config file where settings are stored.</p> <code>'ShellyDevices'</code> <p>Returns:</p> Name Type Description <code>settings</code> <code>list[dict]</code> <p>A list of dict objects, each one represeting a device. Returns an empty list if no devices are configured or the section does not exist.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.load_config","title":"<code>load_config()</code>","text":"<p>Load the configuration from the config file specified to the init method.</p> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If there are YAML errors in the config file, if placeholders are found, or if validation fails.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the configuration was loaded successfully, otherwise False.</p>"},{"location":"reference/configmanager/#sc_utility.sc_config_mgr.SCConfigManager.register_logger","title":"<code>register_logger(logger_function)</code>","text":"<p>Registers a logger function to be used for logging messages.</p> <p>Parameters:</p> Name Type Description Default <code>logger_function</code> <code>Callable</code> <p>The function to use for logging messages.</p> required"},{"location":"reference/csvreader/","title":"CSV Reader","text":"<p>CSVReader class for extracting data from CSV and updating files. </p> <p>The header_config argument to __init__() is a list of dict objects that defines the expected structure of the CSV file. Each dict object in the list should have the following keys:</p> <ul> <li>name: The name of the column.</li> <li>type: The type of the column, which can be 'str', 'int', 'float', 'date', 'datetime' or 'time'.</li> <li>format (optional): A string that defines the format for date, datetime, time or float types (e.g., \"%Y-%m-%d\" for date or \".2f\" for float).</li> <li>match (optional): A boolean indicating if this column should be used for matching records in the merge_data_sets() function.</li> <li>sort (optional): An integer indicating the sort order of the column.</li> <li>minimum (optional): A date, datetime or int that defines a minimum value for filtering by date or datetime.</li> </ul> <p>For example, consider this CSV file:</p> <pre><code>Symbol,Date,Name,Currency,Price\nACM0006AU,2025-04-28,AB Managed Volatility Equities,AUD,1.82\nCSA0038AU,2025-04-28,Bentham Global Income,AUD,1.00\nETL0018AU,2025-04-28,PIMCO Global Bond Wholesale,AUD,0.90\n</code></pre> <p>The header configuration might look like this:</p> <pre><code>header_config = [\n    {\n        \"name\": \"Symbol\",\n        \"type\": \"str\",\n        \"match\": True,\n        \"sort\": 2,\n    },\n    {\n        \"name\": \"Date\",\n        \"type\": \"date\",\n        \"format\": \"%Y-%m-%d\",\n        \"match\": True,\n        \"sort\": 1,\n        \"minimum\": None,\n    },\n    {\n        \"name\": \"Name\",\n        \"type\": \"str\",\n    },\n    {\n        \"name\": \"Currency\",\n        \"type\": \"str\",\n    },\n    {\n        \"name\": \"Price\",\n        \"type\": \"float\",\n        \"format\": \".2f\",\n    },\n]\n</code></pre> <p>Class for reading and writing CSV files with header configuration.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.__init__","title":"<code>__init__(file_path, header_config=None)</code>","text":"<p>Initialize the CSVReader with the file path.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path | str</code> <p>The path to the CSV file. If the file does not exist, it won't be created.</p> required <code>header_config</code> <code>Optional(list[dict])</code> <p>The header configuration for the CSV file.</p> <code>None</code> <p>Raises:</p> Type Description <code>TypeError</code> <p>If header_config is not structured correctly.</p> <code>ImportError</code> <p>If the file not exists but doesn't have a valid extension.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.merge_data_sets","title":"<code>merge_data_sets(primary_list, append_list)</code>","text":"<p>Merges two lists of dictionaries based on header configuration match fields and sorts the result.</p> <p>Parameters:</p> Name Type Description Default <code>primary_list</code> <code>list[dict]</code> <p>The primary list of dictionaries.</p> required <code>append_list</code> <code>list[dict]</code> <p>The list of dictionaries to append or override.</p> required <p>Raises:</p> Type Description <code>ValueError</code> <p>If the dictionaries in the lists do not have the same structure.</p> <p>Returns:</p> Type Description <code>list[dict]</code> <p>list[dict]: The merged and sorted list of dictionaries.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.read_csv","title":"<code>read_csv()</code>","text":"<p>Read the CSV file and return its content.</p> <p>If the file does not exist, return None. If the file has a header but no data, returns an empty list.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the CSV file is empty or has no header.</p> <code>ValueError</code> <p>A value read from the CSV file cannot be converted to the expected type as defined in header_config.</p> <p>Returns:</p> Name Type Description <code>data</code> <code>list[dict]</code> <p>A list of rows from the CSV file or None if the file does not exist.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.sort_csv_data","title":"<code>sort_csv_data(csv_data)</code>","text":"<p>Sort the CSV data based on the header configuration.</p> <p>Parameters:</p> Name Type Description Default <code>csv_data</code> <code>list[dict]</code> <p>The data read from the CSV file.</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>list[dict]: The sorted data.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.trim_csv_data","title":"<code>trim_csv_data(csv_data, max_lines=None, max_days=None)</code>","text":"<p>Trim the CSV data based on the header configuration and optionally the max_lines arg.</p> <p>Parameters:</p> Name Type Description Default <code>csv_data</code> <code>list[dict]</code> <p>The data read from the CSV file.</p> required <code>max_lines</code> <code>Optional(int)</code> <p>If provided, the maximum number of lines to return from csv_data. If this is &gt;0 then it will return the first max_lines lines, if &lt;0 then it will return all but the last abs(max_lines) lines. If None, no trimming is done.</p> <code>None</code> <code>max_days</code> <code>Optional(int)</code> <p>If provided, the maximum number of days to keep in the data based on date headers with 'minimum' set as an int. This overrides any 'minimum' values in the header configuration.</p> <code>None</code> <p>Returns:</p> Type Description <code>list[dict]</code> <p>list[dict]: The trimmed data.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.update_csv_file","title":"<code>update_csv_file(new_data, new_filename=None, max_lines=None, max_days=None)</code>","text":"<p>Appends or merges the new_data into an existing CSV file. If the file does not exist, it will be created.</p> <p>This function will also sort and trim the combined data according to the header configuration.</p> <p>Parameters:</p> Name Type Description Default <code>new_data</code> <code>list[dict]</code> <p>The new data to append or merge.</p> required <code>new_filename</code> <code>Optional(Path | str), optional)</code> <p>If provided, the data will be written to this file instead of the original file.</p> <code>None</code> <code>max_lines</code> <code>Optional(int)</code> <p>If provided, the maximum number of lines to return from csv_data. If this is &gt;0 then it will return the first max_lines lines, if &lt;0 then it will return all but the last abs(max_lines) lines. If None, no trimming is done.</p> <code>None</code> <code>max_days</code> <code>Optional(int)</code> <p>If provided, the maximum number of days to keep in the data based on date headers with 'minimum' set as an int. This overrides any 'minimum' values in the header configuration.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If there is a problem processign the data.</p> <p>Returns:</p> Name Type Description <code>merged_data</code> <code>list[dict]</code> <p>The merged and sorted data after appending or merging the new_data.</p>"},{"location":"reference/csvreader/#sc_utility.sc_csv_reader.CSVReader.write_csv","title":"<code>write_csv(data, new_filename=None)</code>","text":"<p>Write data to the CSV file.</p> <ol> <li>If the file does not exist, it will be created.</li> <li>If the file exists, it will be overwritten.</li> <li>The header will be written based on the header_config.</li> <li>The data will be written in the order of the header_config.</li> <li>If a header in the data does not exist in the header_config, it will be ignored.</li> <li>If a header in the header_config does not exist in the data, throw an exception.</li> <li>Date fields are formatted according to the format specified in header_config.</li> </ol> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>list[dict]</code> <p>The data to write to the CSV file.</p> required <code>new_filename</code> <code>Optional(Path | str), optional)</code> <p>If provided, the data will be written to this file instead of the original file.</p> <code>None</code> <p>Raises:</p> Type Description <code>ValueError</code> <p>If the data is empty or if a header in header_config is not found in the data.</p> <p>Returns:</p> Type Description <code>bool</code> <p>True if the data was written successfully, False otherwise.</p>"},{"location":"reference/datehelper/","title":"Date Helper","text":"<p>Class for simplyify date operations.</p> <p>This class provides static methods to handle date formatting, parsing, and calculations. It defaults to the \"YYYY-MM-DD\" format for date strings, but this can be overridden by passing a different format string. It also handles timezone-aware dates by using the local timezone of the system when parsing and formatting dates.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.add_days","title":"<code>add_days(start_date, days)</code>  <code>staticmethod</code>","text":"<p>Add days to a date or datetime object.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date | datetime</code> <p>The date/datetime to which days will be added.</p> required <code>days</code> <code>int</code> <p>The number of days to add.</p> required <p>Returns:</p> Type Description <code>date | datetime | None</code> <p>result (date | datetime) : A new date or datetime object with the added days, or None if start_date or days is None.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.days_between","title":"<code>days_between(start_date, end_date)</code>  <code>staticmethod</code>","text":"<p>Calculate the number of days between two date or datetime objects.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>date</code> <p>The start date.</p> required <code>end_date</code> <code>date</code> <p>The end date.</p> required <p>Returns:</p> Name Type Description <code>difference</code> <code>int</code> <p>The number of days between the two dates, or None if either date is None.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.format_date","title":"<code>format_date(date_obj, date_format='%Y-%m-%d')</code>  <code>staticmethod</code>","text":"<p>Format a date object to a string.</p> <p>Parameters:</p> Name Type Description Default <code>date_obj</code> <code>date | datetime</code> <p>The date or datetime object to format.</p> required <code>date_format</code> <code>str</code> <p>The format string to use for formatting the date or datetime.</p> <code>'%Y-%m-%d'</code> <p>Returns:</p> Name Type Description <code>date_str</code> <code>str</code> <p>The formatted date string, or None if date_obj is None.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.get_file_date","title":"<code>get_file_date(file_path)</code>  <code>staticmethod</code>","text":"<p>Get the last modified date of a file.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str | Path</code> <p>Path to the file. Can be a string or a Path object.</p> required <p>Returns:</p> Name Type Description <code>date_obj</code> <code>date</code> <p>The last modified date of the file as a date object, or None if the file does not exist.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.get_file_datetime","title":"<code>get_file_datetime(file_path)</code>  <code>staticmethod</code>","text":"<p>Get the last modified datetime of a file.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>str | Path</code> <p>Path to the file. Can be a string or a Path object.</p> required <p>Returns:</p> Name Type Description <code>datetime_obj</code> <code>datetime</code> <p>The last modified datetime of the file as a date object, or None if the file does not exist.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.is_valid_date","title":"<code>is_valid_date(date_str, date_format='%Y-%m-%d')</code>  <code>staticmethod</code>","text":"<p>Check if a date or datetime string is valid according to the specified format.</p> <p>Parameters:</p> Name Type Description Default <code>date_str</code> <code>str</code> <p>The date string to check.</p> required <code>date_format</code> <code>Optional[str]</code> <p>The format string to use for checking the date. Defaults to \"%Y-%m-%d\".</p> <code>'%Y-%m-%d'</code> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the date string is valid, False otherwise.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.now","title":"<code>now()</code>  <code>staticmethod</code>","text":"<p>Get today's date and time.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>datetime</code> <p>Today's date and time as a date object, using the local timezone.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.now_str","title":"<code>now_str(datetime_format='%Y-%m-%d %H:%M:%S')</code>  <code>staticmethod</code>","text":"<p>Get the current time in string format.</p> <p>Parameters:</p> Name Type Description Default <code>datetime_format</code> <code>Optional[str]</code> <p>The format string to use for formatting the datetime.</p> <code>'%Y-%m-%d %H:%M:%S'</code> <p>Returns:</p> Name Type Description <code>result</code> <code>str</code> <p>Current time as a formatted string, using the specified datetime format.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.parse_date","title":"<code>parse_date(date_str, date_format='%Y-%m-%d')</code>  <code>staticmethod</code>","text":"<p>Parse a date string to a date or datetime object.</p> <p>Parameters:</p> Name Type Description Default <code>date_str</code> <code>str</code> <p>The date string to parse.</p> required <code>date_format</code> <code>Optional[str]</code> <p>The format string to use for parsing the date. Defaults to \"%Y-%m-%d\".</p> <code>'%Y-%m-%d'</code> <p>Returns:</p> Name Type Description <code>date_obj</code> <code>date | datetime</code> <p>A date or datetime object representing the parsed date_str, or None if date_str is empty.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.today","title":"<code>today()</code>  <code>staticmethod</code>","text":"<p>Get today's date.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>date</code> <p>Today's date as a date object, using the local timezone.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.today_add_days","title":"<code>today_add_days(days)</code>  <code>staticmethod</code>","text":"<p>Get today's date ofset by days.</p> <p>Parameters:</p> Name Type Description Default <code>days</code> <code>int</code> <p>The number of days to offset from today. Can be positive or negative</p> required <p>Returns:</p> Name Type Description <code>result</code> <code>date</code> <p>Today's date offset by the specified number of days.</p>"},{"location":"reference/datehelper/#sc_utility.sc_date_helper.DateHelper.today_str","title":"<code>today_str(date_format='%Y-%m-%d')</code>  <code>staticmethod</code>","text":"<p>Get today's date in string format.</p> <p>Parameters:</p> Name Type Description Default <code>date_format</code> <code>Optional[str]</code> <p>The format string to use for formatting the date.</p> <code>'%Y-%m-%d'</code> <p>Returns:</p> Name Type Description <code>result</code> <code>str</code> <p>Today's date as a formatted string, using the specified date format.</p>"},{"location":"reference/excelreader/","title":"Excel Reader","text":"<p>A class to read and extract data from Excel files (.xlsx, .xlsm, .xlsb).</p> <p>This class provides methods to load workbooks, extract data from sheets, tables, and named ranges, with robust error handling.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.__init__","title":"<code>__init__(file_path)</code>","text":"<p>Initialize the ExcelReader with the path to the Excel file.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path | str</code> <p>Path to the Excel file, specified as a Path object or string.</p> required <p>Raises:</p> Type Description <code>ImportError</code> <p>If the file does not exist, is not a valid Excel file.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.extract_data","title":"<code>extract_data(source_name, source_type)</code>","text":"<p>Extract data from an Excel file based on the source type and name.</p> <p>Expected the specified source type to be either: - An entire worksheet with the header in the first row (sheet) - A named range (range) - An Excel table (table)</p> <p>Parameters:</p> Name Type Description Default <code>source_name</code> <code>str</code> <p>Name of the sheet, table, or range to extract.</p> required <code>source_type</code> <code>str</code> <p>Type of source ('sheet', 'table', or 'range').</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>Data extracted as a list of dictionaries.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the source type is invalid or if there are issues extracting data.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.extract_from_range","title":"<code>extract_from_range(range_name)</code>","text":"<p>Extract a named range from an Excel file and return it as a list of dictionaries.</p> <p>Parameters:</p> Name Type Description Default <code>range_name</code> <code>str</code> <p>Name of the range to extract.</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>A list containing the range data as dictionaries.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the range cannot be loaded or if there are issues with the file.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.extract_from_sheet","title":"<code>extract_from_sheet(sheet_name)</code>","text":"<p>Extract a sheet from an Excel file and return it as a list of dictionaries.</p> <p>Parameters:</p> Name Type Description Default <code>sheet_name</code> <code>str</code> <p>Name of the sheet to extract.</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>A list containing the sheet data as dictionaries.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the sheet cannot be loaded or if there are issues with the file.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.extract_from_table","title":"<code>extract_from_table(table_name)</code>","text":"<p>Extract a table from an Excel file and return it as a list of dictionaries.</p> <p>Parameters:</p> Name Type Description Default <code>table_name</code> <code>str</code> <p>Name of the table to extract.</p> required <p>Returns:</p> Type Description <code>list[dict]</code> <p>A list containing the table data as dictionaries.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the table cannot be loaded or if there are issues with the file.</p>"},{"location":"reference/excelreader/#sc_utility.sc_excel_reader.ExcelReader.load_excel_workbook","title":"<code>load_excel_workbook(*, data_only=True, read_only=False)</code>","text":"<p>Load an Excel workbook with robust error handling.</p> <p>Parameters:</p> Name Type Description Default <code>data_only</code> <code>bool</code> <p>Whether to return cell values (not formulas).</p> <code>True</code> <code>read_only</code> <code>bool</code> <p>Use openpyxl's read-only mode for large files.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>workbook</code> <code>Workbook</code> <p>Workbook object.</p> <p>Raises:</p> Type Description <code>ImportError</code> <p>If the file cannot be loaded due to various reasons.</p>"},{"location":"reference/jsonencoder/","title":"JSON Encoder","text":"<p>Class to handle encoding and decoding of JSON data with special handling for datetime objects and enumerations.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.decode_object","title":"<code>decode_object(obj)</code>  <code>staticmethod</code>","text":"<p>Convert the object back to its original form, including date and datetime objects.</p> <p>Parameters:</p> Name Type Description Default <code>obj</code> <code>obj</code> <p>The object (list, dict, etc.) to convert.</p> required <p>Returns:</p> Name Type Description <code>object</code> <code>obj</code> <p>The original object.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.deserialise_from_json","title":"<code>deserialise_from_json(json_string)</code>  <code>staticmethod</code>","text":"<p>Deserialises the JSON string to an object, converting as needed.</p> <p>Parameters:</p> Name Type Description Default <code>json_string</code> <code>str</code> <p>The JSON string to deserialise.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the data cannot be deserialized.</p> <p>Returns:</p> Name Type Description <code>return_data</code> <code>object</code> <p>The deserialized object.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.read_from_file","title":"<code>read_from_file(file_path)</code>  <code>staticmethod</code>","text":"<p>Reads the JSON data from a file and decodes it.</p> <p>Parameters:</p> Name Type Description Default <code>file_path</code> <code>Path</code> <p>The path to the JSON file.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the data cannot be read or decoded.</p> <p>Returns:</p> Name Type Description <code>dict</code> <code>object | None</code> <p>The decoded JSON data or None if the file does not exist.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.ready_dict_for_json","title":"<code>ready_dict_for_json(data)</code>  <code>staticmethod</code>","text":"<p>Prepares a dict or list for JSON serialization.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>object</code> <p>The data to prepare.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the data cannot be prepared.</p> <p>Returns:</p> Name Type Description <code>object</code> <code>object</code> <p>A dict or list ready for export to JSON.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.save_to_file","title":"<code>save_to_file(data, file_path)</code>  <code>staticmethod</code>","text":"<p>Saves the date to a JSON file, converting as needed.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>object</code> <p>The data to prepare.</p> required <code>file_path</code> <code>Path</code> <p>The path to the JSON file to be created.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the data cannot be serialized.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the pricing data was saved, False if not.</p>"},{"location":"reference/jsonencoder/#sc_utility.sc_json_encoder.JSONEncoder.serialise_to_json","title":"<code>serialise_to_json(data)</code>  <code>staticmethod</code>","text":"<p>Serialises the data to a JSON string, converting as needed.</p> <p>Parameters:</p> Name Type Description Default <code>data</code> <code>object</code> <p>The data to prepare.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the data cannot be serialized.</p> <p>Returns:</p> Name Type Description <code>str</code> <code>str</code> <p>The JSON string representation of the data.</p>"},{"location":"reference/logging/","title":"Logging","text":"<p>A class to handle logging messages with different verbosity levels.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.__init__","title":"<code>__init__(logger_settings)</code>","text":"<p>Initializes the logger with configuration settings.</p> <p>The structure of logger_settings is as follows: {     \"logfile_name\": Optional[str],  # The name of the log file. If None, no file logging will be done.     \"file_verbosity\": Optional[str],  # Verbosity level for file logging     \"console_verbosity\": Optional[str],  # Verbosity level for console logging     \"max_lines\": Optional[int],  # Maximum number of lines to keep in the log file     \"log_process_id\": Optional[bool],  # If True, include the process ID in log messages. Defaults to False.     \"log_thread_id\": Optional[bool],  # If True, include the thread ID in log messages. Defaults to False. }</p> <p>Parameters:</p> Name Type Description Default <code>logger_settings</code> <code>Optional[dict]</code> <p>A dictionary containing logger settings</p> required"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.clear_fatal_error","title":"<code>clear_fatal_error()</code>","text":"<p>Clear a previously logged fatal error.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the file was deleted, False if it did not exist.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.clear_notifiable_issue","title":"<code>clear_notifiable_issue(entity, issue_type)</code>","text":"<p>Clear a notifiable issue.</p> <p>If an email was previously sent for this issue, this function will send a \"cleared\" notification email.</p> <p>Parameters:</p> Name Type Description Default <code>entity</code> <code>str</code> <p>The entity reporting the issue (e.g., \"Device 123\", \"Module\", etc.)</p> required <code>issue_type</code> <code>str</code> <p>A brief description of the issue (e.g. \"Offline\").</p> required <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the issue was found and cleared, False otherwise.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.get_fatal_error","title":"<code>get_fatal_error()</code>","text":"<p>Returns True if a fatal error was previously reported, false otherwise.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.initialise_settings","title":"<code>initialise_settings(logger_settings)</code>","text":"<p>Set / reset the logger configuration settings. See the init() method for the structure of logger_settings.</p> <p>Parameters:</p> Name Type Description Default <code>logger_settings</code> <code>Optional[dict]</code> <p>A dictionary containing logger settings.</p> required"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.log_fatal_error","title":"<code>log_fatal_error(message, report_stack=False, calling_function=None)</code>","text":"<p>Log a fatal error, send an email if configured to so and then exit the program.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>str</code> <p>The error message to log.</p> required <code>report_stack</code> <code>Optional[bool]</code> <p>If True, include the stack trace in the log message.</p> <code>False</code> <code>calling_function</code> <code>Optional[str]</code> <p>The name of the function that called this method, if known. If None, the calling function will be determined automatically.</p> <code>None</code> <p>Raises:</p> Type Description <code>SystemExit</code> <p>Exits the program with a status code of 1 after logging the fatal error.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.log_message","title":"<code>log_message(message, verbosity='summary')</code>","text":"<p>Writes a log message to the console and/or a file based on verbosity settings.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>str</code> <p>The message to log.</p> required <code>verbosity</code> <code>str</code> <p>The verbosity level for the message. Must be one of \"none\", \"error\", \"warning\", \"summary\", \"detailed\", \"debug\", or \"all\".</p> <code>'summary'</code> <p>Raises:</p> Type Description <code>ValueError</code> <p>If an invalid verbosity level is provided.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.register_email_settings","title":"<code>register_email_settings(email_settings)</code>","text":"<p>Registers email settings for sending emails.</p> <p>Use the SCConfigManager.get_email_settings() method to get a dictionary containing the email settings. Otherwise, you can pass a dictionary directly to this method with these keys:     SendEmailsTo: str, the email address to send emails to     SMTPServer: str, the SMTP server address     SMTPPort: int, the SMTP server port (optional, defaults to 587)     SMTPUsername: str, the username for the SMTP server     SMTPPassword: str, the password for the SMTP server (preferably an App Password)     SubjectPrefix: str, a prefix for email subjects (optional, default to None)</p> <p>Parameters:</p> Name Type Description Default <code>email_settings</code> <code>Optional[dict]</code> <p>A dictionary containing email settings. If empty or None, no email settings will be registered.</p> required <p>Raises:</p> Type Description <code>TypeError</code> <p>If email_settings is not a dictionary.</p> <code>ValueError</code> <p>If any required keys are missing from the email_settings dictionary.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.report_notifiable_issue","title":"<code>report_notifiable_issue(entity, issue_type, send_delay, message)</code>","text":"<p>Log a notifiable issue and send an email if configured to do so.</p> <p>When a new combination of entity and issue_type is reported, it will be noted including the current timestamp. If one or more issues of the same type are reported for the same entity at least send_delay seconds after the last notification, an email will be sent including the first time this issue was reported. Subsequent issues of the same type for the same entity will be ignored until the issue is cleared.</p> <p>Parameters:</p> Name Type Description Default <code>entity</code> <code>str</code> <p>The entity reporting the issue (e.g., \"Device 123\", \"Module\", etc.)</p> required <code>issue_type</code> <code>str</code> <p>A brief description of the issue (e.g. \"Offline\").</p> required <code>send_delay</code> <code>int</code> <p>The delay in seconds before sending the email</p> required <code>message</code> <code>str</code> <p>The issue message to log and email.</p> required <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the email was sent, False otherwise.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.send_email","title":"<code>send_email(subject, body, test_mode=False)</code>","text":"<p>Sends an email using the SMTP server previously specified in register_email_settings().</p> <p>Parameters:</p> Name Type Description Default <code>subject</code> <code>str</code> <p>The subject of the email.</p> required <code>body</code> <code>str</code> <p>The body of the email. This argument can be one of 4 things: 1. A string containing the HTML body of the email 2. A string or Path containing the path to an HTML file to read the body from 3. A string containing the text body of the email 4. A string or Path containing the path to an text file to read the body from</p> required <code>test_mode</code> <code>bool</code> <p>If True, the email will not be sent, but a message will be logged indicating that the email would have been sent. Defaults to False.</p> <code>False</code> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the email was sent successfully, False otherwise.</p>"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.set_fatal_error","title":"<code>set_fatal_error(message)</code>","text":"<p>Create a fatal error tracking file and write the message to it.</p> <p>Parameters:</p> Name Type Description Default <code>message</code> <code>str</code> <p>The error message to write to the fatal error file.</p> required"},{"location":"reference/logging/#sc_utility.sc_logging.SCLogger.trim_logfile","title":"<code>trim_logfile()</code>","text":"<p>Trims the log file to the maximum number of lines specified.</p>"},{"location":"reference/shelly_control/","title":"Shelly Smart Switch Control","text":"<p>See the Shelly Control Getting Started Guide for a guide to using the ShellyControl class.</p> <p>Control interface for Shelly Smart Switch devices.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.__init__","title":"<code>__init__(logger, device_settings, app_wake_event=None)</code>","text":"<p>Initializes the ShellySwitch object.</p> <p>Parameters:</p> Name Type Description Default <code>logger</code> <code>SCLogger</code> <p>The logger instance to use for logging messages.</p> required <code>device_settings</code> <code>dict</code> <p>A dictionary containing the device, as returned by SCConfigManager.get_shelly_settings().</p> required <code>app_wake_event</code> <code>Event | None</code> <p>An optional event to wake the application when a webhook is received.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the switch_settings configuration is invalid or incomplete or the model file cannot be found.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.change_output","title":"<code>change_output(output_identity, new_state)</code>","text":"<p>Change the state of a Shelly device output to on or off.</p> <p>Parameters:</p> Name Type Description Default <code>output_identity</code> <code>dict | int | str</code> <p>An output dict, or the ID or name of the device to check.</p> required <code>new_state</code> <code>bool</code> <p>The new state to set the output to (True for on, False for off).</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>There was an error changing the device output state.</p> <code>TimeoutError</code> <p>If the device is online (ping) but the state change request times out.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the output state was changed successfully, False if the device is offline.</p> <code>did_change</code> <code>bool</code> <p>True if the output state is different than before, False if it was already in the desired state.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.does_device_have_webhooks","title":"<code>does_device_have_webhooks(device)</code>","text":"<p>Returns True if the device has any webhooks installed, False otherwise.</p> <p>Parameters:</p> Name Type Description Default <code>device</code> <code>dict</code> <p>The Shelly device dictionary to check for webhooks.</p> required <p>Returns:</p> Name Type Description <code>bool</code> <code>bool</code> <p>True if the device has webhooks installed, False otherwise.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.get_device","title":"<code>get_device(device_identity)</code>","text":"<p>Returns the device index for a given device ID or name.</p> <p>For device_identity you can pass: - A device object (dict) to retrieve it directly. - The device ID (int) to look it up by ID. - The device name (str) to look it up by name. - A component object (dict), which will return the parent device.</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>dict | int | str</code> <p>The identifier for the device.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices.</p> <p>Returns:</p> Name Type Description <code>device</code> <code>dict</code> <p>The device object if found.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.get_device_component","title":"<code>get_device_component(component_type, component_identity, use_index=None)</code>","text":"<p>Returns a device component's index for a given component ID or name.</p> <p>Parameters:</p> Name Type Description Default <code>component_type</code> <code>str</code> <p>The type of component to retrieve ('input', 'output', 'meter' or 'temp_probe').</p> required <code>component_identity</code> <code>int | str</code> <p>The ID or name of the component to retrieve.</p> required <code>use_index</code> <code>bool | None</code> <p>If True, lookup by index instead of ID or name.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the component is not found in the list.</p> <p>Returns:</p> Name Type Description <code>component</code> <code>dict</code> <p>The component index if found.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.get_device_information","title":"<code>get_device_information(device_identity, refresh_status=False)</code>","text":"<p>Returns a consolidated copy of a Shelly device information as a single dictionary, including its inputs, outputs, and meters.</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>dict | int | str</code> <p>The device itself or an ID or name of the device to retrieve information for.</p> required <code>refresh_status</code> <code>bool</code> <p>If True, refreshes the device status before retrieving information. Defaults to False.</p> <code>False</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices or if there is an error getting the status.</p> <p>Returns:</p> Name Type Description <code>device_info</code> <code>dict</code> <p>A dictionary containing the device's attributes, inputs, outputs, and meters.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.get_device_location","title":"<code>get_device_location(device_identity)</code>","text":"<p>Gets the timezone and location of a Shelly device if available.</p> Returns a dict in the following format <p>\"tz\": \"Europe/Sofia\", \"lat\": 42.67236, \"lon\": 23.38738</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>dict | int | str</code> <p>A device dict, or the ID or name of the device to check.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices or if there is an error getting the status.</p> <code>TimeoutError</code> <p>If the device is online (ping) but the request times out while getting the device status.</p> <p>Returns:</p> Name Type Description <code>location</code> <code>dict | None</code> <p>A dictionary containing the timezone and location of the device, or None if not available.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.get_device_status","title":"<code>get_device_status(device_identity)</code>","text":"<p>Gets the status of a Shelly device.</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>dict | int | str</code> <p>A device dict, or the ID or name of the device to check.</p> required <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices or if there is an error getting the status.</p> <code>TimeoutError</code> <p>If the device is online (ping) but the request times out while getting the device status.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the device is online, False otherwise.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.initialize_settings","title":"<code>initialize_settings(device_settings, refresh_status=True)</code>","text":"<p>Initializes the Shelly devices using the provided settings.</p> <p>Parameters:</p> Name Type Description Default <code>device_settings</code> <code>dict</code> <p>A dictionary containing the device settings.</p> required <code>refresh_status</code> <code>bool | None</code> <p>Whether to refresh the status of the devices.</p> <code>True</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device settings are invalid or incomplete.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.install_webhook","title":"<code>install_webhook(event, component, url=None, additional_payload=None)</code>","text":"<p>Install a webhook for the specified device and component.</p> <p>The function is used internally to install input and/or output webhooks that will be handled by the ShellyControl webhook handler server, but it can also be used to install additional webhooks that point to your own enpoint. If you use this function for custom webhooks, make sure your device supports the webhook event.</p> <p>The SupportedWebhooks attrbute of the device object lists the webhook events that each device supports (if any). See this page for documentation: https://shelly-api-docs.shelly.cloud/gen2/ComponentsAndServices/Webhook#webhookcreate</p> <p>You must have set the ShellyDevices: WebhooksEnabled configuration parameter to True for this function to install a webhook.</p> The following arguments will automatically be added to the url string if not already provided <p>Event: The event type that triggered the webhook DeviceID: The ID attribute of the device that this webhook came from. ObjectType: The type of the component that this webhook came from. One of \"input\", \"output\", \"meter\" ComponentID: The ID attribute of the component that this webhook came from.</p> <p>For example:    http://192.16.81.23:8787/shelly/webhook?Event=input.toggle_on&amp;DeviceID=1&amp;ObjectType=input&amp;ComponentID=2</p> <p>Parameters:</p> Name Type Description Default <code>event</code> <code>str</code> <p>The event type to install the webhook for. This is case sensitive and must match the event type supported by the device          and componnent. For example \"input.toggle_on\". A RunTime error will be thrown is the event type is not supported.</p> required <code>component</code> <code>dict</code> <p>The component object for the device component that you want to install the webhook on.</p> required <code>url</code> <code>str | None</code> <p>The URL to send the webhook to. If None, the URL will be constructed using the webhook host, port, and path.</p> <code>None</code> <code>additional_payload</code> <code>dict | None</code> <p>Additional key/value pairs to include in the webhook payload, for example active_between.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the webhook installation fails.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.is_device_online","title":"<code>is_device_online(device_identity=None)</code>","text":"<p>See if a device is alive by pinging it.</p> <p>Returns the result and updates the device's online status. If we are in simulation mode, always returns True.</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>Optional(dict | int | str | None)</code> <p>The actual device object, device component object, device ID or device name of the device to check. If None, checks all device.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices.</p> <p>Returns:</p> Name Type Description <code>result</code> <code>bool</code> <p>True if the device is online, False otherwise. If all devices are checked, returns True if all device are online.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.print_device_status","title":"<code>print_device_status(device_identity=None)</code>","text":"<p>Prints the status of a device or all devices.</p> <p>Parameters:</p> Name Type Description Default <code>device_identity</code> <code>Optional(int | str | None)</code> <p>The ID or name of the device to check. If None, checks all devices.</p> <code>None</code> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If the device is not found in the list of devices.</p> <p>Returns:</p> Name Type Description <code>device_info</code> <code>str</code> <p>A string representation of the device status.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.print_model_library","title":"<code>print_model_library(mode_str='brief', model_id=None)</code>","text":"<p>Prints the Shelly model library.</p> <p>Parameters:</p> Name Type Description Default <code>mode_str</code> <code>str</code> <p>The mode of printing. Can be \"brief\" or \"detailed\". Defaults to \"brief\".</p> <code>'brief'</code> <code>model_id</code> <code>Optional(str)</code> <p>If provided, filters the models by this model name. If None, prints all models.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>library_info</code> <code>str</code> <p>A string representation of the Shelly model library.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.pull_webhook_event","title":"<code>pull_webhook_event()</code>","text":"<p>Pulls a webhook event from the queue.</p> <p>Use this if your app has been interrupted by a webhook event (your app_wake_event was set). This will return the earliest webhook event that was received and remove it from the queue.</p> <p>Returns:</p> Type Description <code>dict | None</code> <p>dict | None: The next webhook event from the queue, or None if the queue is empty.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.refresh_all_device_statuses","title":"<code>refresh_all_device_statuses()</code>","text":"<p>Refreshes the status of all Shelly devices.</p> <p>This function iterates through all devices and updates their status by calling get_device_status. It also calculates the total power and energy consumption for each device.</p> <p>Raises:</p> Type Description <code>RuntimeError</code> <p>If there is an error getting the status of any device.</p>"},{"location":"reference/shelly_control/#sc_utility.sc_shelly_control.ShellyControl.shutdown","title":"<code>shutdown()</code>","text":"<p>Cleanly shutdown the ShellyControl instance and stop the webhook server.</p> <p>This method should be called when the parent application is terminating to ensure proper cleanup of resources.</p>"},{"location":"reference/weather_client/","title":"WeatherClient","text":"<p>This class provides a simple wrapper for the OpenWeathermap and Open Meteo weather providers. It returns the current and forecast weather for the designated location. </p> <p>The class will attempt to retrieve the weather data from the providers in this order: 1. OWM paid subscription (OWM_API_KEY required.) 2. OWM free tier (OWM_API_KEY required.) 3. Open Meteo weather.</p> <p>For the first two options, an OWM API key is required. You can obtain one at https://openweathermap.org.</p> <p>The following data classes are used by this class:</p> <pre><code>@dataclass\nclass Wind:\n    speed: float\n    deg: float | None\n    units: str = \"km/h\"\n\n\n@dataclass\nclass WeatherReading:\n    utc_time: datetime\n    local_time: datetime\n    temperature: float\n    sky: str\n    wind: Wind\n\n\n@dataclass\nclass WeatherStation:\n    source: str\n    latitude: float\n    longitude: float\n</code></pre>"},{"location":"reference/weather_client/#weather_client.WeatherClient.__init__","title":"<code>__init__(latitude, longitude, owm_api_key=None)</code>","text":"<p>Initialize the WeatherClient.</p> <p>Parameters:</p> Name Type Description Default <code>latitude</code> <code>float</code> <p>Latitude of the location to fetch weather for.</p> required <code>longitude</code> <code>float</code> <p>Longitude of the location to fetch weather for.</p> required <code>owm_api_key</code> <code>str | None</code> <p>Optional OpenWeatherMap API key for enhanced data.</p> <code>None</code>"},{"location":"reference/weather_client/#weather_client.WeatherClient.get_open_meteo_weather","title":"<code>get_open_meteo_weather()</code>","text":"<p>Fetch weather data from Open Meteo.</p> <p>Returns:</p> Type Description <code>tuple[WeatherReading, list[WeatherReading], WeatherStation]</code> <p>A tuple of (current reading, list of hourly readings, weather station info).</p>"},{"location":"reference/weather_client/#weather_client.WeatherClient.get_weather","title":"<code>get_weather()</code>","text":"<p>Fetch weather data from providers, falling back as needed.</p> <p>Returns:</p> Type Description <code>tuple[WeatherReading, list[WeatherReading], WeatherStation]</code> <p>A tuple of (current reading, list of hourly readings, weather station info).</p>"}]}